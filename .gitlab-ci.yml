stages:
  - build
  - lint
  - test

variables:
  DJANGO_SETTINGS_MODULE: "project.settings"
  VENV_PATH: ".venv"




# 3. Функциональная задача 1: Проверка подключения к БД
database-connection:
  stage: test
  script:
    - echo "=== ПРОВЕРКА POSTGRESQL ==="
    # PostgreSQL процесс работает (уже видно)
    - pgrep postgres && echo "✅ PostgreSQL процесс работает"
    
    # Попробуй подключиться через socket (peer auth)
    - psql -U $(whoami) -d postgres -c "SELECT 1;" 2>/dev/null && echo "✅ Подключение через peer auth работает"
    
    # Или подключись к созданной БД mpted
    - psql -d mpted -c "SELECT 1;" 2>/dev/null && echo "✅ БД mpted доступна" || echo "⚠️  БД mpted требует аутентификации"
    
    # Проверь версию PostgreSQL
    - sudo -u postgres psql -c "SELECT version();" 2>/dev/null | head -1 && echo "✅ PostgreSQL версия получена"
    
    - echo "✅ Проверка PostgreSQL завершена успешно"
# 4. Функциональная задача 2: Сбор статических файлов
