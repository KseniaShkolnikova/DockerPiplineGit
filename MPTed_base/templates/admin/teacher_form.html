{% extends "base.html" %}

{% block title %}{% if teacher_user %}Редактирование учителя{% else %}Добавление учителя{% endif %} - MPTed{% endblock %}

{% block content %}
<div class="admin-container">
    {% include "includes/sidebar.html" %}
    
    <main class="main-content">
        <div class="content-header">
            <div class="header-left">
                <h1 class="content-title">
                    {% if teacher_user %}
                    Редактирование учителя
                    {% else %}
                    Добавление нового учителя
                    {% endif %}
                </h1>
                <p class="content-subtitle">
                    {% if teacher_user %}
                    {{ teacher_user.last_name }} {{ teacher_user.first_name }} {{ profile.patronymic|default:"" }}
                    {% else %}
                    Заполните информацию о новом учителе
                    {% endif %}
                </p>
            </div>
            <div class="header-actions">
                <a href="{% url 'teachers_list' %}" class="btn btn-outline">
                    <i class="bi bi-arrow-left"></i>
                    Назад к списку
                </a>
            </div>
        </div>
        
        <div class="form-container">
            <form method="post" class="teacher-form">
                {% csrf_token %}
                
                <div class="form-card">
                    <h3 class="form-title">Основная информация</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="last_name">Фамилия *</label>
                            <input type="text" 
                                   id="last_name" 
                                   name="last_name" 
                                   value="{{ teacher_user.last_name|default:'' }}" 
                                   required
                                   class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="first_name">Имя *</label>
                            <input type="text" 
                                   id="first_name" 
                                   name="first_name" 
                                   value="{{ teacher_user.first_name|default:'' }}" 
                                   required
                                   class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="patronymic">Отчество *</label>
                            <input type="text" 
                                   id="patronymic" 
                                   name="patronymic" 
                                   value="{{ profile.patronymic|default:'' }}" 
                                   required
                                   class="form-input">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="username">Логин *</label>
                            <input type="text" 
                                   id="username" 
                                   name="username" 
                                   value="{{ teacher_user.username|default:'' }}" 
                                   required
                                   class="form-input">
                            <small class="form-help">Уникальное имя для входа в систему</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" 
                                   id="email" 
                                   name="email" 
                                   value="{{ teacher_user.email|default:'' }}" 
                                   class="form-input">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="phone">Телефон</label>
                            <input type="tel" 
                                   id="phone" 
                                   name="phone" 
                                   value="{{ profile.phone|default:'' }}" 
                                   class="form-input"
                                   placeholder="+7 (XXX) XXX-XX-XX">
                        </div>
                        
                        <div class="form-group">
                            <label for="qualification">Квалификация</label>
                            <input type="text" 
                                   id="qualification" 
                                   name="qualification" 
                                   value="{{ profile.qualification|default:'' }}" 
                                   class="form-input"
                                   placeholder="Высшая категория, Кандидат наук и т.д.">
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3 class="form-title">Безопасность и доступ</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" 
                                   name="is_active" 
                                   {% if teacher_user.is_active or not teacher_user %}checked{% endif %}>
                            <span>Активный аккаунт (может входить в систему)</span>
                        </label>
                    </div>
                    
                    {% if not teacher_user %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="password">Пароль *</label>
                            <input type="password" 
                                   id="password" 
                                   name="password" 
                                   required
                                   class="form-input">
                            <small class="form-help">Не менее 6 символов</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm_password">Подтверждение пароля *</label>
                            <input type="password" 
                                   id="confirm_password" 
                                   name="confirm_password" 
                                   required
                                   class="form-input">
                        </div>
                    </div>
                    {% else %}
                    <div class="form-group">
                        <label for="password">Новый пароль (оставьте пустым, чтобы не менять)</label>
                        <input type="password" 
                               id="password" 
                               name="password" 
                               class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password">Подтверждение нового пароля</label>
                        <input type="password" 
                               id="confirm_password" 
                               name="confirm_password" 
                               class="form-input">
                    </div>
                    {% endif %}
                </div>
                
                {% if teacher_user and subjects %}
                <div class="form-card">
                    <h3 class="form-title">Преподаваемые предметы</h3>
                    <div class="subjects-list">
                        {% for subject in subjects %}
                        <span class="subject-tag">
                            {{ subject.name }}
                            <a href="{% url 'teacher_subjects' teacher_user.id %}" 
                               class="subject-remove" 
                               title="Удалить предмет">
                                <i class="bi bi-x"></i>
                            </a>
                        </span>
                        {% endfor %}
                    </div>
                    <div class="form-help">
                        <a href="{% url 'teacher_subjects' teacher_user.id %}" class="btn-link">
                            <i class="bi bi-plus"></i>
                            Управление предметами
                        </a>
                    </div>
                </div>
                {% endif %}
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i>
                        {% if teacher_user %}Сохранить изменения{% else %}Создать учителя{% endif %}
                    </button>
                    <a href="{% url 'teachers_list' %}" class="btn btn-outline">Отмена</a>
                </div>
            </form>
        </div>
    </main>
</div>
{% endblock %}
